import os, glob,numpy as np
from PIL import Image
import leargist 
import _pickle as cPickle

os.chdir('malimg_paper_dataset_imgs')
families = os.listdir(os.getcwd())
images_perF = []
print(families)

for i in range(len(families)):
  length = len(glob.glob(str(families[i])+ '/*.png'))
  images_perF.append(length)
print(images_perF)
num_images = sum(images_perF)

# Generating y features
y = np.zeros(num_images)
start = 0
for i in range(len(families)):
  y[start:start+images_perF[i]] = i
  start += images_perF[i]
print(len(y))
print(y)

# Generating x features
x = np.zeros((num_images, 320))
n = 0
for f in families:
  images = glob.glob(str(f) + '/*.png')
  for i in images:
    im = Image.open(i)
    im = im.resize((64,64),Image.ANTIALIAS)
    print(i)
    x[n] = leargist.color_gist(im)[0:320]
    n += 1
print(x)

fname = 'malware'
os.chdir('../data')
cPickle.dump(families,open(fname+'.p','wb'))
cPickle.dump(families,open('nums.p','wb'))
np.save(fname +'_features.npy',x)
np.save(fname+'_labels.npy',y)